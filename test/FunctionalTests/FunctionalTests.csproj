<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <RootNamespace>System.Data.Entity</RootNamespace>
    <AssemblyName>EntityFramework.FunctionalTests</AssemblyName>
    <TargetFrameworks>net461;$(DefaultNetCoreTargetFramework)</TargetFrameworks>
    <DefineConstants>$(DefineConstants);EF_FUNCTIONALS</DefineConstants>
    <NoWarn>$(NoWarn);CS0169</NoWarn>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'net452'">
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.ComponentModel.DataAnnotations" />
    <Reference Include="System.Configuration" />
    <Reference Include="System.Transactions" />
    <Reference Include="WindowsBase" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\src\ErikEJ.EntityFramework.SqlServer\ErikEJ.EntityFramework.SqlServer.csproj" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'net452'">
    <Content Include="$(NuGetPackageRoot)microsoft.sqlserver.types\$(MicrosoftSqlServerTypesVersion)\content\readme.htm">
      <Link>SqlServerTypes\readme.htm</Link>
    </Content>
    <Content Include="$(NuGetPackageRoot)microsoft.sqlserver.types\$(MicrosoftSqlServerTypesVersion)\nativeBinaries\x64\msvcr120.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>SqlServerTypes\x64\msvcr120.dll</Link>
    </Content>
    <Content Include="$(NuGetPackageRoot)microsoft.sqlserver.types\$(MicrosoftSqlServerTypesVersion)\nativeBinaries\x64\SqlServerSpatial140.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>SqlServerTypes\x64\SqlServerSpatial140.dll</Link>
    </Content>
    <Content Include="$(NuGetPackageRoot)microsoft.sqlserver.types\$(MicrosoftSqlServerTypesVersion)\nativeBinaries\x86\msvcr120.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>SqlServerTypes\x86\msvcr120.dll</Link>
    </Content>
    <Content Include="$(NuGetPackageRoot)microsoft.sqlserver.types\$(MicrosoftSqlServerTypesVersion)\nativeBinaries\x86\SqlServerSpatial140.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>SqlServerTypes\x86\SqlServerSpatial140.dll</Link>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <Content Remove="C:\Users\eej\.nuget\packages\microsoft.sqlserver.types\\content\readme.htm" />
    <Content Remove="C:\Users\eej\.nuget\packages\microsoft.sqlserver.types\\nativeBinaries\x64\msvcr120.dll" />
    <Content Remove="C:\Users\eej\.nuget\packages\microsoft.sqlserver.types\\nativeBinaries\x64\SqlServerSpatial140.dll" />
    <Content Remove="C:\Users\eej\.nuget\packages\microsoft.sqlserver.types\\nativeBinaries\x86\msvcr120.dll" />
    <Content Remove="C:\Users\eej\.nuget\packages\microsoft.sqlserver.types\\nativeBinaries\x86\SqlServerSpatial140.dll" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="..\..\src\Common\TypeExtensions.cs">
      <Link>Utilities\TypeExtensions.cs</Link>
    </Compile>
    <Compile Include="..\..\src\Common\DebugCheck.cs">
      <Link>Utilities\DebugCheck.cs</Link>
    </Compile>
    <Compile Include="..\..\src\Common\MemberInfoExtensions.cs">
      <Link>Utilities\MemberInfoExtensions.cs</Link>
    </Compile>
    <Compile Include="..\..\src\Common\AssemblyExtensions.cs">
      <Link>Utilities\AssemblyExtensions.cs</Link>
    </Compile>
    <Compile Include="..\..\src\Common\PropertyInfoExtensions.cs">
      <Link>Utilities\PropertyInfoExtensions.cs</Link>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="xunit" Version="2.4.1" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.4.3">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
  </ItemGroup>

  <ItemGroup>
    <Reference Include="System.Transactions" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="WrappingProvider\WrappingCommand.cs">
      <SubType>Component</SubType>
    </Compile>
    <Compile Update="WrappingProvider\WrappingConnection.cs">
      <SubType>Component</SubType>
    </Compile>
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == '$(DefaultNetCoreTargetFramework)'">
    <None Update="xunit.console.dll.config">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <ItemGroup>
    <Service Include="{508349B6-6B84-4DF5-91F0-309BEEBAD82D}" />
    <Service Include="{82A7F48D-3B50-4B1E-B82E-3ADA8210C358}" />
  </ItemGroup>

  <PropertyGroup>
    <PostBuildEvent Condition="'$(OS)' == 'Windows_NT' And '$(TargetFramework)' == 'net452'">
      if not exist "$(TargetDir)x86" md "$(TargetDir)x86"
      xcopy /s /y "$(NuGetPackageRoot)Microsoft.SqlServer.Compact\$(MicrosoftSqlServerCompactVersion)\NativeBinaries\x86\*.*" "$(TargetDir)x86"
      if not exist "$(TargetDir)amd64" md "$(TargetDir)amd64"
      xcopy /s /y "$(NuGetPackageRoot)Microsoft.SqlServer.Compact\$(MicrosoftSqlServerCompactVersion)\NativeBinaries\amd64\*.*" "$(TargetDir)amd64"
    </PostBuildEvent>
  </PropertyGroup>

</Project>
